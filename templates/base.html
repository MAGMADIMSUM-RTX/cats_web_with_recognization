<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ğŸ± çŒ«å’ªç›¸å†Œ{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <!-- å·¦ä¾§ä¾§è¾¹æ  -->
        <div class="sidebar">
            <a href="{{ url_for('home') }}" class="sidebar-btn {% if request.endpoint == 'home' %}active{% endif %}">
                <div class="icon">ğŸ </div>
                <div class="label">ä¸»é¡µ</div>
            </a>
            <a href="{{ url_for('search') }}" class="sidebar-btn {% if request.endpoint == 'search' %}active{% endif %}">
                <div class="icon">ğŸ”</div>
                <div class="label">æœç´¢</div>
            </a>
            <a href="{{ url_for('recent') }}" class="sidebar-btn {% if request.endpoint == 'recent' %}active{% endif %}">
                <div class="icon">ğŸ†•</div>
                <div class="label">æœ€è¿‘</div>
            </a>
            <a href="{{ url_for('favorites') }}" class="sidebar-btn {% if request.endpoint == 'favorites' %}active{% endif %}">
                <div class="icon">ğŸ˜½</div>
                <div class="label">æˆ‘çš„</div>
            </a>
            <!-- ä¸Šä¼ æŒ‰é’®åœ¨JSä¸­å¤„ç†ï¼Œä»¥æ˜¾ç¤º/éšè—ä¸Šä¼ åŒºåŸŸ -->
            <button class="sidebar-btn" id="upload-btn-nav">
                <div class="icon">ğŸ“¤</div>
                <div class="label">ä¸Šä¼ </div>
            </button>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            {% block content %}{% endblock %}
        </div>

        <!-- å³ä¾§ä¾§è¾¹æ  -->
        <div class="right-sidebar" id="right-sidebar">
            <h3>ğŸ”¥ è¿‘æœŸçƒ­é—¨</h3>
            <div class="hot-photos" id="hot-photos">
                <!-- çƒ­é—¨ç…§ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </nav>

    <!-- å›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="modal-overlay" style="display: none;">
        <div class="modal-content">
            <img class="modal-image" id="modal-image" src="" alt="æ”¾å¤§çš„çŒ«å’ªå›¾ç‰‡">
            <button class="modal-close" id="modal-close">âœ•</button>
            <div class="modal-actions">
                <button class="modal-save-btn" id="modal-save-btn">ğŸ’– ä¿å­˜åˆ°æ”¶è—</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div id="notification-container"></div>

    <script src="{{ url_for('static', filename='js/nav.js') }}"></script>
    <script src="{{ url_for('static', filename='js/image-modal.js') }}"></script>
    <script>
        // åŠ è½½å³ä¾§ä¾§è¾¹æ çš„çƒ­é—¨ç…§ç‰‡
        document.addEventListener('DOMContentLoaded', function() {
            const hotPhotos = document.getElementById('hot-photos');
            const rightSidebar = document.getElementById('right-sidebar');
            
            // åªåœ¨ä¸»é¡µæ˜¾ç¤ºå³ä¾§ä¾§è¾¹æ 
            if (window.location.pathname === '/') {
                rightSidebar.style.display = 'block';
                
                // åŠ è½½æ”¶è—çš„ç…§ç‰‡ä½œä¸ºçƒ­é—¨ç…§ç‰‡
                async function loadHotPhotos() {
                    try {
                        const response = await fetch('/api/favorites');
                        const data = await response.json();
                        
                        if (data.success && data.favorites.length > 0) {
                            hotPhotos.innerHTML = '';
                            // åªæ˜¾ç¤ºæœ€è¿‘çš„3å¼ æ”¶è—ç…§ç‰‡
                            const recentFavorites = data.favorites.slice(0, 3);
                            
                            recentFavorites.forEach(favorite => {
                                const photoItem = document.createElement('div');
                                photoItem.className = 'hot-photo-item';
                                
                                const img = document.createElement('img');
                                img.src = favorite.url;
                                img.alt = 'æ”¶è—çš„çŒ«å’ª';
                                
                                // ä»URLä¸­æå–çŒ«å’ªåå­—
                                const urlParts = favorite.url.split('/');
                                const catName = urlParts[urlParts.length - 2] || 'æœªçŸ¥';
                                
                                const photoName = document.createElement('div');
                                photoName.className = 'photo-name';
                                photoName.textContent = decodeURIComponent(catName);
                                
                                const photoActions = document.createElement('div');
                                photoActions.className = 'photo-actions';
                                
                                const likedBtn = document.createElement('button');
                                likedBtn.className = 'like-btn liked';
                                likedBtn.innerHTML = 'âœ… å·²æ”¶è—';
                                likedBtn.disabled = true;
                                
                                photoActions.appendChild(likedBtn);
                                photoItem.appendChild(img);
                                photoItem.appendChild(photoName);
                                photoItem.appendChild(photoActions);
                                
                                // ç‚¹å‡»å›¾ç‰‡è·³è½¬åˆ°æ”¶è—é¡µé¢
                                img.onclick = () => {
                                    window.location.href = '/favorites';
                                };
                                
                                hotPhotos.appendChild(photoItem);
                            });
                        } else {
                            hotPhotos.innerHTML = '<p style="color: #666; font-size: 12px; text-align: center;">æš‚æ— æ”¶è—</p>';
                        }
                    } catch (error) {
                        console.error('åŠ è½½çƒ­é—¨ç…§ç‰‡å¤±è´¥:', error);
                        hotPhotos.innerHTML = '<p style="color: #666; font-size: 12px; text-align: center;">åŠ è½½å¤±è´¥</p>';
                    }
                }
                
                loadHotPhotos();
            } else {
                // åœ¨éä¸»é¡µéšè—å³ä¾§ä¾§è¾¹æ 
                rightSidebar.style.display = 'none';
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
